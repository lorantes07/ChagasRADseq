####Pipeplien Summary###

#######12/19/2014#############
# Log Pipeline for T.dimidiata 
Log in to MASON: ssh lorantes@mason.indiana.edu Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim_tdim.tags.tsv
passphrase: mi mama me mima 
Personal directory: /N/u/lorantes/Mason 
Sara's directory: N/u/scahan/Mason 
Sara's scratch space (60 day space):/N/dc2/scratch/scahan/ 
Lucia's scratch space (60 day space): N/dc2/scratch/lorantes/ 
>/N/dc2/scratch/lorantes> mkdir floragenex
#file containing filtered, trimmed and original sequences for floragenex
sftp> cd /N/dc2/scratch/lorantes> mkdir floragenex/original 
sftp> put *.fq # got to /Volumes/HD-LBU3/Floragenex_pilot_data/Dorn_Triatomine_201304/Raw_Illumina_Sequence to retrieve the files from /N/dc2/scratch/lorantes/floragenex/original.

########1/27/2015###########
# Goal is to create a forward loop (using bash) to alliterate a sequence through the 6 genomes of
# tcruzi. Everything will be done using scahan scratch files and scripts. 
lorantes@Mason: /N/dc2/scratch> chmod 777 lorantes #gave public permission to use my scratch folder.
# Sara copied one of the files to her sandbox to play with it.
>run bowtie-build.sh # create indexes from fasta files, in this case Tcruzi genome. 
#Name of the Tcruzi indexes
	#AAHK01.1.fsa
	#ADWP02.1.fsa
	#AHKC01.1.fsa
	#ANOX01.1.fsa
	#AODP01.1.fsa
	#AQHO01.fsa
 
#####2/4/2015#######
# Goal is to create script that reiterates through all Tcruzi genomes and leaves a file of unmapped reads. 

> less bowtie.sh #shows:

#! /bin/bash
#PBS -k o
#PBS -l nodes=2:ppn=8,vmem=10gb,walltime=12:00:00
#PBS -M scahan@uvm.edu
#PBS -m abe
#PBS -N bowtie
#PBS -j oe
module load 
cd /N/dc2/scratch/scahan/ddRAD1_fastq/ddRAD1_fastq/filtered/Pogo_tests
cp -r /N/dc2/scratch/scahan/indexes .
#mkdir mapped_files sam_files
for X in *.fq; do bowtie Pogo $X -S ${X%.*}.sam; mv $X ../mapped_files; mv *.sam ../sam_files; done

# modifying bash script to reiterate through all genomes:

#! /bin/bash
#PBS -k o
#PBS -l nodes=2:ppn=8,vmem=10gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTcruzi
#PBS -j oe
module load bowtie
cd /N/dc2/scratch/scahan/sandbox_lucia/Raw
mkdir unmapped_files sam_files
for X in *.fq; do bowtie AAHK01 $X -S ${X%.*}_AAHK01.sam --un ${X%.*}_unmapped1.fq; mv $X ./unmapped_files; mv *.sam ./sam_files; bowtie ADWP02 ${X%.*}_unmapped1.fq -S ${X%.*}_ADWP02.sam --un ${X%.*}_unmapped2.fq; mv $X ./unmapped_files; mv *.sam ./sam_files; bowtie AHKC01 ${X%.*}_unmapped2.fq -S ${X%.*}_AHKC01.sam --un ${X%.*}_unmapped3.fq; mv $X ./unmapped_files; mv *.sam ./sam_files; bowtie ANOX01 ${X%.*}_unmapped3.fq -S ${X%.*}_ANOX01.sam --un ${X%.*}_unmapped4.fq; mv $X ./unmapped_files; mv *.sam ./sam_files; bowtie AODP01 ${X%.*}_unmapped4.fq -S ${X%.*}_AODP01.sam --un ${X%.*}_unmapped5.fq; mv $X ./unmapped_files; mv *.sam ./sam_files; bowtie AQHO01 ${X%.*}_unmapped5.fq -S ${X%.*}_AQHO01.sam --un ${X%.*}_unmappedforTdim.fq; mv $X ./unmapped_files; mv *.sam ./sam_files; done

fstp> put Raw_Illumina_Sequence.zip #put raw files in a directory called floragenex_fasta
>mv Raw_Illumina_Sequence.zip ../../../../home/l/o/lorantes/Mason #moved the zipfile to my permanent directory
>ls -l | wc -l # number of files in the folder. 

###/3/12/14#####

> echo $PATH #print path
> ls -1 | wc -l #list number of lines in a folder. 
> cp -r path../folder/ path../folder/ & #copy a folder from path1 to path2 in the background(&).  

#re-attempting to write a script  that works for Tcruzi genome. 

#! /bin/bash
#PBS -k o
#PBS -l nodes=2:ppn=8,vmem=10gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTcruzi
#PBS -j oe

module load bowtie 
cd /N/dc2/scratch/scahan/sandbox_lucia/RawFloragenex/
cp -r /N/dc2/scratch/scahan/indexes 
mkdir unmapped_files sam_files mapped_files
for X in *.fq; do bowtie AAHK01 $X -S ${X%.*}_AAHK01.sam --un ${X%.*}_unmapped1.fq; mv $X ./mapped_files; mv *.sam ./sam_files; bowtie ADWP02 ${X%.*}_unmapped1.fq -S ${X%.*}_ADWP02.sam --un ${X%.*}_unmapped2.fq; mv *.sam ./sam_files; bowtie AHKC01 ${X%.*}_unmapped2.fq -S ${X%.*}_AHKC01.sam --un ${X%.*}_unmapped3.fq; mv *.sam ./sam_files; bowtie ANOX01 ${X%.*}_unmapped3.fq -S ${X%.*}_ANOX01.sam --un ${X%.*}_unmapped4.fq; mv *.sam ./sam_files; bowtie AODP01 ${X%.*}_unmapped4.fq -S ${X%.*}_AODP01.sam --un ${X%.*}_unmapped5.fq; mv *.sam ./sam_files; bowtie AQHO01 ${X%.*}_unmapped5.fq -S ${X%.*}_AQHO01.sam --un ${X%.*}_unmappedforTdim.fq; mv *.sam ./sam_files; mv *_unmapped* ./unmapped_files; done

####3/24/14####
# /N/u/lorantes/Mason/RawFloragenex #repository of complete/uncorrupted Floragenex files.


# modified bowtie_Lucia.sh to copy files into sandbox_lucia

#! /bin/bash
#PBS -k o
#PBS -l nodes=2:ppn=8,vmem=10gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTcruzi
#PBS -j oe

module load bowtie 
cd /N/dc2/scratch/scahan/sandbox_lucia/Floragenex
cp ../../../../../u/lorantes/Mason/RawFloragenex/*.fq . 
cp -r /N/dc2/scratch/scahan/indexes .
mkdir unmapped_files sam_files mapped_files
for X in *.fq; do bowtie AAHK01 $X -S ${X%.*}_AAHK01.sam --un ${X%.*}_unmapped1.fq; mv $X ./mapped_files; mv *.sam ./sam_files; bowtie ADWP02 ${X%.*}_unmapped1.fq -S ${X%.*}_ADWP02.sam --un ${X%.*}_unmapped2.fq; mv *.sam ./sam_files; bowtie AHKC01 ${X%.*}_unmapped2.fq -S ${X%.*}_AHKC01.sam --un ${X%.*}_unmapped3.fq; mv *.sam ./sam_files; bowtie ANOX01 ${X%.*}_unmapped3.fq -S ${X%.*}_ANOX01.sam --un ${X%.*}_unmapped4.fq; mv *.sam ./sam_files; bowtie AODP01 ${X%.*}_unmapped4.fq -S ${X%.*}_AODP01.sam --un ${X%.*}_unmapped5.fq; mv *.sam ./sam_files; bowtie AQHO01 ${X%.*}_unmapped5.fq -S ${X%.*}_AQHO01.sam --un ${X%.*}_unmappedforTdim.fq; mv *.sam ./sam_files; mv *_unmapped* ./unmapped_files; done
rm -r ./indexes

> qsub bowtie_Lucia.sh #run bowtie_Lucia.sh to obtain mapped reads of floragenex files for T. cruzi. 
> qstat -u lorantes #monitor work by my user. 

# modified stacks denovo assembly of Floragenex legs to create leg catalog. 

#! /bin/bash
#PBS -k o
#PBS -l nodes=2:ppn=8,vmem=10gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu        
#PBS -m abe
#PBS -N stacksDenovoLegFloragenex
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia/Floragenex/RawForCatalog
cp ../../../../../../u/lorantes/Mason/RawFloragenex/Dorn_Triatomine_TP901_sequence_1.fq ./
cp ../../../../../../u/lorantes/Mason/RawFloragenex/Dorn_Triatomine_TP-904_sequence_1.fq ./
cp ../../../../../../u/lorantes/Mason/RawFloragenex/Dorn_Triatomine_TP-903_sequence_1.fq ./ 
cp ../../../../../../u/lorantes/Mason/RawFloragenex/Dorn_Triatomine_TP-930_sequence_1.fq ./
cp ../../../../../../u/lorantes/Mason/RawFloragenex/Dorn_Triatomine_TP-939_sequence_1.fq ./
cp ../../../../../../u/lorantes/Mason/RawFloragenex/Dorn_Triatomine_CHJ462Leg_sequence_1.fq ./
cp ../../../../../../u/lorantes/Mason/RawFloragenex/Dorn_Triatomine_Codigo-*_sequence_1.fq ./
cp ../../../../../../u/lorantes/Mason/RawFloragenex/Dorn_Triatomine_S431Leg_sequence_1.fq ./
denovo_map.pl -T 15 -m 1 -M 4 -N 6 -n 4 -o ./FloragenexDenovo/ -S -i 1 -b 1 -t -s ./Dorn_Triatomine_TP901_sequence_1.fq  -s ./Dorn_Triatomine_TP-903_sequence_1.fq -s ./Dorn_Triatomine_TP-904_sequence_1.fq -s ./Dorn_Triatomine_TP-930_sequence_1.fq -s ./Dorn_Triatomine_Codigo-0124_sequence_1.fq  -s ./Dorn_Triatomine_TP-939_sequence_1.fq -s ./Dorn_Triatomine_Codigo-0074_sequence_1.fq -s ./Dorn_Triatomine_Codigo-0188_sequence_1.fq -s ./Dorn_Triatomine_Codigo-0225_sequence_1.fq -s ./Dorn_Triatomine_Codigo-0275_sequence_1.fq -s ./Dorn_Triatomine_S431Leg_sequence_1.fq -s ./Dorn_Triatomine_CHJ462Leg_sequence_1.fq 

###3/25/15###
# bowtie_Lucia to run the tcruzi mapping hit the wall. Increased wall time to 24H. 

cut -f 3,10 batch_1.catalog.tags.tsv > catalog.tab # edit .tsv from output directory to have only Locus ID and sequence columns to upload as a reference file for bugs mapping in Bowtie. 
# convert from tab to fasta so it can be read by bowtie. 

 "gb" *.sam > aligned_only.sam # get the scaffold name lines plus the mapped sequence lines plus the mapped sequence lines.

grep "NM" *.sam | wc -l #get a count of only the sequence lines. 

####4/16/15####
> mv bowtie_Lucia.sh to bowtie_TcruziFloragenex.sh #change name of script
>qsub bowtie_TcruziFloragenex.sh #Tcruzi scrip again to go through the rest of files. 


#twitch stacks_denovoLeg.sh to perform denovo assembly with legs from output from tcruzi search.

#! /bin/bash
#PBS -k o
#PBS -l nodes=4:ppn=4,vmem=100gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu        
#PBS -m abe
#PBS -N stacksDenovoLegFloragenex
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia/Floragenex/RawForCatalog
cp ../unmapped_files/Dorn_Triatomine_TP901_sequence_1_unmappedforTdim.fq ./
cp ../unmapped_files/Dorn_Triatomine_TP-904_sequence_1_unmappedforTdim.fq ./
cp ../unmapped_files/Dorn_Triatomine_TP-903_sequence_1_unmappedforTdim.fq ./
cp ../unmapped_files/Dorn_Triatomine_TP-930_sequence_1_unmappedforTdim.fq ./
cp ../unmapped_files/Dorn_Triatomine_TP-939_sequence_1_unmappedforTdim.fq ./
cp ../unmapped_files/Dorn_Triatomine_CHJ462Leg_sequence_1_unmappedforTdim.fq ./
cp ../unmapped_files/Dorn_Triatomine_Codigo-*_sequence_1_unmappedforTdim.fq ./
cp ../unmapped_files/Dorn_Triatomine_S431Leg_sequence_1_unmappedforTdim.fq ./

denovo_map.pl -T 15 -m 1 -M 4 -N 6 -n 4 -o ./ -S -i 1 -b 1 -t -s ./Dorn_Triatomine_TP901_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-903_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-904_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-930_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0124_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-939_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0074_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0188_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0225_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0275_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_S431Leg_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_CHJ462Leg_sequence_1_unmappedforTdim.fq 

####4/17/2015####
>qsub bowtie_TcruziFloragenex.sh ##changed memory to run faster node=8, core=2, vmem=60

####4/20/2015####
#bowtie_TcruziFloragenex.sh finished running. 
>qsub stacks_denovoLeg.sh #to assemble leg catalog
> mv #copied all files of sample A5201 of Tcruzi sequences to test cat and grep to unify all sam files into a single file, after filtering for "XA". 

> grep "XA" Dorn_Triatomine_A5201_sequence_1_*.sam >A5201_Tcruzi.sam ; grep -c "XA" A5201_Tcruzi.sam >> TcruziReadCount.csv #grab XA for sequences that were mapped for all files from the same insect but different genomes. It will cat all of them, then count how many XA lines are in the cat file. 

> for X in `cat tcruziList.txt`; do echo Dorn_Triatomine_$X; do grep "XA" Dorn_Triatomine_$X_* >> $X_Tcruzi.sam; done #create pipeline to do previous commands through all samples. 

###4/21/2015####
/LegCatalog> cut -f 2 batch_1.sumstats.tsv | uniq | wc -l  #number of SNPs retrieved just catalog
48764 
/LegCatalog> cut -f 2,9 batch_1.sumstats.tsv | uniq | cut -f 2 | sort | uniq -c #number of SNPs that appear per sample. 
  27288 1
   1179 10
    682 11
    214 12
   7106 2
   3407 3
   2744 4
   2347 5
   2132 6
   1949 7
   1794 8
   1566 9
test> ls | cut -d "_" -f 3 | uniq> tcruziList.txt # create a file with the names of the unique samples, stripped of any repetitive part of the name.      
## havent been able to create a script that iterates and creates files only with the files for the specific insect. 


> cat stacks_refmapTcruzi.sh #make script to run ref map for tcruzi samples. 
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=60gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N RefmapTcruzi
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia/Floragenex/sam_files
mv Dorn_Triatomine_*_sequence_1_*.sam ~/TcruziSamFiles/
ref_map.pl -s ./A5201.tcruzi.sam -s ./A9252.tcruzi.sam -s ./A9253.tcruzi.sam -s ./Abdomen5.tcruzi.sam -s ./B46.tcruzi.sam -s ./BS230Ab.tcruzi.sam -s ./C1504.tcruzi.sam -s ./CHJ14.tcruzi.sam -s ./B46.tcruzi.sam -s ./CHJ21.tcruzi.sam -s ./CHJ3.tcruzi.sam -s ./CHJ462Ab.tcruzi.sam -s ./CHJ462Leg.tcruzi.sam -s ./CHJ506Ab.tcruzi.sam -s ./Codigo-0074.tcruzi.sam -s ./Codigo-0124.tcruzi.sam -s ./Codigo-0188.tcruzi.sam -s ./Codigo-0225.tcruzi.sam -s ./Codigo-0275.tcruzi.sam -s ./S134.tcruzi.sam -s ./S210Ab.tcruzi.sam -s ./S431Leg.tcruzi.sam -s ./TP194.tcruzi.sam -s ./TP838.tcruzi.sam -s ./TP-900.tcruzi.sam -s ./TP901.tcruzi.sam -s ./TP-903.tcruzi.sam -s ./TP-904.tcruzi.sam -s ./TP-930.tcruzi.sam -s ./TP-937.tcruzi.sam -s ./TP-939.tcruzi.sam -o ./tcruzirefmap/ -n 3 -m 3 -T 8 -S -i 1 

### 05/04/2015 ###
#Convert denovo assembly of leg catalog to bowtie index. 
Floragenex/legCatalog> cut -f 3,10 batch_1.catalog.tags.tsv > catalog.tab #extract the two important columns from the cat catalog tag file. 
Floragenex/legCatalog> awk '{print ">"$1"\n"$2}' catalog.tab > catalog.fa #convert from tab to fasta 

> qsub bowtie-buqildLegCat.sh  #submit a job to convert catalog.fa to bowtie index 
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=20gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtie-buildFloragenex
#PBS -j oe

module load bowtie
cd /N/dc2/scratch/scahan/sandbox_lucia/Floragenex/legCatalog/
bowtie-build catalog.fa tdimFloragenex
mv *.ebwt ~/N/dc2/scratch/scahan/indexes 


> qsub bowtie_TdimFloragenex.sh #submit a job to run bowtie and align all reads to index. 
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=60gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTdim
#PBS -j oe

module load bowtie
cd /N/dc2/scratch/scahan/sandbox_lucia/Floragenex/bowtieTdim
cp ../bowtieTcruzi/unmapped_files/Dorn_Triatomine_*_sequence_1_unmappedforTdim.fq .
cp -r ../indexes/ .
mkdir unmapped_files sam_files mapped_files
for X in *.fq; do bowtie tdimFloragenex $X -S ${X%.*}_tdim.sam --un ${X%.*}_post-map.fq; mv $X ./mapped_files; mv *.sam ./sam_files; mv *_post-map* ./unmapped_files; done
rm -r indexes/

###05/07/2015###

>qsub stacks_refmapTdimFloragenex.sh ##loaded script to run stacks ref_map for Tdim. 

#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=60gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N RefmapTdim
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia/Floragenex/TcruziRefMap
cp ../bowtieTdim/sam_files/*_tdim.sam .
mkdir ./outputTdim
ref_map.pl -s Dorn_Triatomine_A5201_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_A9252_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_A9253_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Abdomen5_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_B46_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_BS230Ab_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_C1504_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ14_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ21_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ3_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ462Ab_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ462Leg_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ506Ab_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0074_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0124_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0188_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0225_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0275_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_S134_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_S210Ab_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_S431Leg_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP194_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP838_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-900_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP901_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-903_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-904_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-930_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-937_sequence_1_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-939_sequence_1_unmappedforTdim_tdim.sam -o ./outputTcruzi -n 3 -m 3 -T 8 -S -i 1 -b 1 --alpha 0.1
 
>qsub stacks_refmapTcruziFloragenex.sh ##loaded script to run stacks ref_map for Tcruzi.
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=60gb,walltime=16:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N RefmapTcruzi
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia/Floragenex/TcruziRefMap
# cp ../bowtieTcruzi/sam_files/*.tcruzi.sam .
# mkdir outputTcruzi 
ref_map.pl -s A5201.tcruzi.sam -s A9252.tcruzi.sam -s A9253.tcruzi.sam -s Abdomen5.tcruzi.sam -s B46.tcruzi.sam -s BS230Ab.tcruzi.sam -s C1504.tcruzi.sam -s CHJ14.tcruzi.sam -s B46.tcruzi.sam -s CHJ21.tcruzi.sam -s CHJ3.tcruzi.sam -s CHJ462Ab.tcruzi.sam -s CHJ462Leg.tcruzi.sam -s CHJ506Ab.tcruzi.sam -s Codigo-0074.tcruzi.sam -s Codigo-0124.tcruzi.sam -s Codigo-0188.tcruzi.sam -s Codigo-0225.tcruzi.sam -s Codigo-0275.tcruzi.sam -s S134.tcruzi.sam -s S210Ab.tcruzi.sam -s S431Leg.tcruzi.sam -s TP194.tcruzi.sam -s TP838.tcruzi.sam -s TP-900.tcruzi.sam -s TP901.tcruzi.sam -s TP-903.tcruzi.sam -s TP-904.tcruzi.sam -s TP-930.tcruzi.sam -s TP-937.tcruzi.sam -s TP-939.tcruzi.sam -o ./outputTcruzi -n 3 -m 1 -T 8 -S -i 1 -b 1 --alpha 0.1

###05/14/15###
> qsub genotypes_TdimFloragenex.sh # Stacks > grab haplotype output, pass filter and output into encoded genotype. 
	> input > genotypes -b 1 -P ./ -r 1 -m 2 --min_hom_seqs 1 -t GEN

> python ../../../../scripts/Filtering_taxaNUM_SNPnum_Floragenex.py batch_1.genotypes_1.tsv #  Use filter to pick out specified number of taxa per tag, then extract tags that have the specified number of SNPs and the specified number of individuals. We used 3 SNP per tag, at least in 17 individuals. 
	
>qsub haplotypes_to_fasta.py # convert to unicode then to fasta. 
	
 sftp> get haplotypes_1_SNp3filter17.fas # move output file to my desktop
Fetching /N/dc2/scratch/scahan/sandbox_lucia/Floragenex/TdimRefMap/outputTdim/haplotypes_1_SNp3filter17.fas to haplotypes_1_SNp3filter17.fas
/N/dc2/scratch/scahan/sandbox_lucia/Floragenex/TdimR 100%  147KB 147.2KB/s   00:00    
sftp> get batch_1.haplotypes_1_SNp3filter17_variable2_single.tsv # move output file to my desktop
Fetching 
Fetching /N/dc2/scratch/scahan/sandbox_lucia/Floragenex/TdimRefMap/outputTdim/batch_1.haplotypes_1_SNp3filter17_variable2_single.tsv to batch_1.haplotypes_1_SNp3filter17_variable2_single.tsv
lorantes@Mason: /N/dc2/scratch/scahan/Tcruzi_genomes/fasta_files> ls
sAAHK01.1.fsa_nt
ADWP02.1.fsa_nt
AHKC01.1.fsa_nt
ANOX01.1.fsa_nt
AODP01.1.fsa_nt
AQHO01.1.fsa_nt
AYLP01.1.fsa_nt
CH473xxx_CLBrenner_WGS_SCAFLD_AAHK01.fasta
Dm28c_AYLP01.fasta
KB205xxx_EsmeralsoCl3_WGS_SCAFLD_ANOX01.fasta
KB22xxxx_JRcl4_WGS_SCAFLD_AODP01.fasta
KB85xxxx_TulaCl2_WGS_SCAFLD_AQHO01.fasta
Other_Tcruzi_sequences.fasta
other_Tcruzi_set1.fasta
other_Tcruzi_set2.fasta
other_Tcruzi_set3.fasta
other_Tcruzi_set4.fasta
SylvioX10_ADWP02.fasta
TcIV_canIII_Genbank.fasta
TcMarinkStrB7_AHKC01.1.fasta

### 10/21/2015
#Need to re-run full pipeline. Starting with Trim using FastX tools, using threshold of 10 reads min. 
>/N/dc2/scratch/scahan/scripts_101515> nano fastq_filter_Floragenex.sh #modified script fastq_filter.sh to trim samples in sandbox_lucia/RawSeq, renamed fastq_filter_Floragenex.sh. Changed core requirements to make it faster. 
#! /bin/bash
#PBS -k o
#PBS -l nodes=6:ppn=2,vmem=20gb,walltime=6:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N fastq_filter_Floragenex
#PBS -j oe

FASTX=/N/soft/mason/galaxy-apps/fastx_toolkit_0.0.13/fastq_quality_filter
cd /N/dc2/scratch/scahan/sandbox_lucia_101515/Floragenex/RawSeq
#cd /N/dc2/scratch/scahan/Pop1_analyses/trimmed
#cd /N/dc2/scratch/scahan/Chagas_0715/GBS2015/plate_3/trimmed-f7-l91
#cd /N/dc2/scratch/scahan/ddRAD2/ddRAD2_redo/trimmed
#cd /N/dc2/scratch/scahan/sandbox_0615/
mkdir ../filtered
for X in *.fq; do $FASTX -Q33 -q 10 -p 100  -i $X -o ${X%.*}_filtered.fq; mv ${X%.*}_filtered.fq ../filtered; done
>qsub qsub fastq_filter_Floragenex.sh
#! /bin/bash
#PBS -k o
#PBS -l nodes=6:ppn=2,vmem=20gb,walltime=6:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N fastq_filter_Floragenex
#PBS -j oe

FASTX=/N/soft/mason/galaxy-apps/fastx_toolkit_0.0.13/fastq_quality_filter
cd /N/dc2/scratch/scahan/sandbox_lucia_101515/Floragenex/RawSeq
#cd /N/dc2/scratch/scahan/Pop1_analyses/trimmed
#cd /N/dc2/scratch/scahan/Chagas_0715/GBS2015/plate_3/trimmed-f7-l91
#cd /N/dc2/scratch/scahan/ddRAD2/ddRAD2_redo/trimmed
#cd /N/dc2/scratch/scahan/sandbox_0615/
mkdir ../filtered
for X in *.fq; do $FASTX -Q33 -q 10 -p 100  -i $X -o ${X%.*}_filtered.fq; mv ${X%.*}_filtered.fq ../filtered; done

lorantes@Mason: /N/dc2/scratch/scahan/sandbox_lucia_101515/Floragenex/filtered> expr length "TGCAGGACAAATAGAACAGTTTGTTCTTGTCCTGATTTCCCCTCGCCGCTAATATCATAAAAGTATATATATTTCAATCTCGTGCCTCCCT"
91 #count number of characters in string.The total number of bases that are above a threshold of 10X depth = 91.


/N/dc2/scratch/scahan/scripts_101515> mv bowtie_TcruziFloragenex.sh bowtie_Tcruzi_Floragenex.sh #change named of script as it reads better
/N/dc2/scratch/scahan/scripts_101515> nano bowtie_Tcruzi_Floragenex.sh #updated script so that if finds the new folder “filter” and extracts the .fq files from it. 
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=60gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTcruzi
#PBS -j oe

module load bowtie 
cd /N/dc2/scratch/scahan/sandbox_lucia_101515/Floragenex/
cp ./filtered/*.fq . 
# cp -r /N/dc2/scratch/scahan/indexes .
mkdir unmapped_files sam_files mapped_files
for X in *.fq; do bowtie AAHK01 $X -S ${X%.*}_AAHK01.sam --un ${X%.*}_unmapped1.fq; mv $X ./mapped_files; mv *.sam ./sam_files; bowtie ADWP02 ${X%.*}_unmapped1.fq -S ${X%.*}_ADWP02.sam --un ${X%.*}_unmapped2.fq; mv *.sam ./sam_files; bowtie AHKC01 ${X%.*}_unmapped2.fq -S ${X%.*}_AHKC01.sam --un ${X%.*}_unmapped3.fq; mv *.sam ./sam_files; bowtie ANOX01 ${X%.*}_unmapped3.fq -S ${X%.*}_ANOX01.sam --un ${X%.*}_unmapped4.fq; mv *.sam ./sam_files; bowtie AODP01 ${X%.*}_unmapped4.fq -S ${X%.*}_AODP01.sam --un ${X%.*}_unmapped5.fq; mv *.sam ./sam_files; bowtie AQHO01 ${X%.*}_unmapped5.fq -S ${X%.*}_AQHO01.sam --un ${X%.*}_unmappedforTdim.fq; mv *.sam ./sam_files; mv *_unmapped* ./unmapped_files; done


lorantes@Mason: ~/Floragenex/bowtieTcruzi/unmapped_files> ls -d *unmappedforTdim.fq* | wc -l #count number of files with the string “unmappedforTdim.fq” on name. 

lorantes@Mason: ~> grep -c "HWI" *.fq > Floragenex_RawReadCount.txt & #counts the  mapped lines with occurrence of HWI in each file. 


/N/dc2/scratch/scahan/scripts_101515> nano denovo_leg_Floragenex.sh #modifications to denovo script.
#! /bin/bash
#PBS -k o
#PBS -l nodes=10:ppn=2,vmem=120gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu        
#PBS -m abe
#PBS -N DenovoLegFloragenex
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_101515/Floragenex/legDenovo
cp ../bowtieTcruzi/unmapped_files/Dorn_Triatomine_TP901_sequence_1_unmappedforTdim.fq ./
cp ../bowtieTcruzi/unmapped_files/Dorn_Triatomine_TP-904_sequence_1_unmappedforTdim.fq ./
cp ../bowtieTcruzi/unmapped_files/Dorn_Triatomine_TP-903_sequence_1_unmappedforTdim.fq ./
cp ../bowtieTcruzi/unmapped_files/Dorn_Triatomine_TP-930_sequence_1_unmappedforTdim.fq ./
cp ../bowtieTcruzi/unmapped_files/Dorn_Triatomine_TP-939_sequence_1_unmappedforTdim.fq ./
cp ../bowtieTcruzi/unmapped_files/Dorn_Triatomine_CHJ462Leg_sequence_1_unmappedforTdim.fq ./
cp ../bowtieTcruzi/unmapped_files/Dorn_Triatomine_Codigo-*_sequence_1_unmappedforTdim.fq ./
cp ../bowtieTcruzi/unmapped_files/Dorn_Triatomine_S431Leg_sequence_1_unmappedforTdim.fq ./
denovo_map.pl -T 15 -m 2 -M 3 -N 5 -n 3 -o ./ -S -i 1 -b 1 -t -s ./Dorn_Triatomine_TP901_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-903_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-904_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-930_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0124_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-939_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0074_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0188_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0225_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0275_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_S431Leg_sequence_1_unmappedforTdim.fq -s ./Dorn_Triatomine_CHJ462Leg_sequence_1_unmappedforTdim.fq 


##Oct 26, 2015##
#After difficulties running T. cruz script, I have cleaned all the Filtered files, and Sara has cleaned the T. cruzi script. 

nano bowtie_TcruziFloragenex.sh #modified Tcruzi script to remove bugs.
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=60gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTcruzi
#PBS -j oe

module load bowtie 
cd /N/dc2/scratch/scahan/sandbox_lucia_101515/Floragenex/bowtieTcruzi
cp ../filtered/*.fq .
cp -r ../indexes .
mkdir unmapped_files sam_files Tdim_files mapped_files
for X in *.fq; do echo $X; bowtie AAHK01 $X -S ${X%.*}_AAHK01.sam --un ${X%.*}_unmapped1.fq; mv $X ./mapped_files; bowtie ADWP02 ${X%.*}_unmapped1.fq -S ${X%.*}_ADWP02.sam --un ${X%.*}_unmapped2.fq; bowtie AHKC01 ${X%.*}_unmapped2.fq -S ${X%.*}_AHKC01.sam --un ${X%.*}_unmapped3.fq; bowtie ANOX01 ${X%.*}_unmapped3.fq -S ${X%.*}_ANOX01.sam --un ${X%.*}_unmapped4.fq; bowtie AODP01 ${X%.*}_unmapped4.fq -S ${X%.*}_AODP01.sam --un ${X%.*}_unmapped5.fq; bowtie AQHO01 ${X%.*}_unmapped5.fq -S ${X%.*}_AQHO01.sam --un ${X%.*}_unmapped6.fq; bowtie Other_Tcruzi ${X%.*}_unmapped6.fq -S ${X%.*}_Other-Tcruzi.sam --un ${X%.*}_unmapped7.fq; bowtie TcIV ${X%.*}_unmapped7.fq -S ${X%.*}_TcVI.sam --un ${X%.*}_unmappedforTdim.fq; mv *.sam ./sam_files; mv *_unmappedfor* ./Tdim_files; mv *_unmapped*  ./unmapped_files; done
chmod 777 unmapped_files sam_files Tdim_files mapped_files 
rm -rf indexes 

lorantes@Mason: /N/dc2/scratch/scahan/scripts_101515> qsub bowtie_TcruziFloragenex.sh 
#submission ID:334122.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=120gb,walltime=36:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTcruzi
#PBS -j oe

module load bowtie 
cd /N/dc2/scratch/scahan/sandbox_lucia_101515/Floragenex
mkdir bowtieTcruzi_102815
cd bowtieTcruzi_102815
cp ../filtered/*.fq .
cp -r ../indexes .
mkdir unmapped_files sam_files Tdim_files mapped_files
for X in *.fq; do echo $X; bowtie AAHK01 $X -S ${X%.*}_AAHK01.sam --un ${X%.*}_unmapped1.fq; mv $X ./mapped_files; bowtie ADWP02 ${X%.*}_unmapped1.fq -S ${X%.*}_ADWP02.sam --un ${X%.*}_unmapped2.fq; bowtie AHKC01 ${X%.*}_unmapped2.fq -S ${X%.*}_AHKC01.sam --un ${X%.*}_unmapped3.fq; bowtie ANOX01 ${X%.*}_unmapped3.fq -S ${X%.*}_ANOX01.sam --un ${X%.*}_unmapped4.fq; bowtie AODP01 ${X%.*}_unmapped4.fq -S ${X%.*}_AODP01.sam --un ${X%.*}_unmapped5.fq; bowtie AQHO01 ${X%.*}_unmapped5.fq -S ${X%.*}_AQHO01.sam --un ${X%.*}_unmapped6.fq; bowtie Other_Tcruzi ${X%.*}_unmapped6.fq -S ${X%.*}_Other-Tcruzi.sam --un ${X%.*}_unmapped7.fq; bowtie TcIV ${X%.*}_unmapped7.fq -S ${X%.*}_TcVI.sam --un ${X%.*}_unmappedforTdim.fq; mv *.sam ./sam_files; mv *_unmappedfor* ./Tdim_files; mv *_unmapped*  ./unmapped_files; done
chmod 777 unmapped_files sam_files Tdim_files mapped_files  

###11.2.2015###
#T. cruzi bowtie finished running, need to twitch the leg denovo script and run int. 

/N/dc2/scratch/scahan/scripts_1115> less denovo_leg_Floragenex.sh  
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=120gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu        
#PBS -m abe
#PBS -N DenovoLegFloragenex
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_1115/Floragenex/legDenovo
cp ../bowtieTcruzi/Tdim_files/Dorn_Triatomine_TP901_sequence_1_filtered_unmappedforTdim.fq ./
cp ../bowtieTcruzi/Tdim_files/Dorn_Triatomine_TP-904_sequence_1_filtered_unmappedforTdim.fq ./
cp ../bowtieTcruzi/Tdim_files/Dorn_Triatomine_TP-903_sequence_1_filtered_unmappedforTdim.fq ./
cp ../bowtieTcruzi/Tdim_files/Dorn_Triatomine_TP-930_sequence_1_filtered_unmappedforTdim.fq ./
cp ../bowtieTcruzi/Tdim_files/Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim.fq ./
cp ../bowtieTcruzi/Tdim_files/Dorn_Triatomine_CHJ462Leg_sequence_1_filtered_unmappedforTdim.fq ./
cp ../bowtieTcruzi/Tdim_files/Dorn_Triatomine_Codigo-*_sequence_1_filtered_unmappedforTdim.fq ./
cp ../bowtieTcruzi/Tdim_files/Dorn_Triatomine_S431Leg_sequence_1_filtered_unmappedforTdim.fq ./
denovo_map.pl -T 15 -m 2 -M 3 -N 5 -n 3 -o ./ -S -i 1 -b 1 -t -s ./Dorn_Triatomine_TP901_sequence_1_filtered_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-903_sequence_1_filtered_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-904_sequence_1_filtered_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-930_sequence_1_filtered_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0124_sequence_1_filtered_unmappedforTdim.fq -s ./Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0074_sequence_1_filtered_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0188_sequence_1_filtered_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0225_sequence_1_filtered_unmappedforTdim.fq -s ./Dorn_Triatomine_Codigo-0275_sequence_1_filtered_unmappedforTdim.fq -s ./Dorn_Triatomine_S431Leg_sequence_1_filtered_unmappedforTdim.fq -s ./Dorn_Triatomine_CHJ462Leg_sequence_1_filtered_unmappedforTdim.fq 

/N/dc2/scratch/scahan/scripts_1115> qsub denovo_legFloragenex.sh #submission ID: 335273.m1.mason

##12.20.2015##
#Convert denovo assembly of leg catalog to bowtie index. 
Floragenex/legCatalog> cut -f 3,10 batch_1.catalog.tags.tsv > catalog.tab #extract the two important columns from the cat catalog tag file. 
Floragenex/legCatalog> awk '{print ">"$1"\n"$2}' catalog.tab > catalog.fa #convert from tab to fasta 

> /N/dc2/scratch/scahan/scripts_121515> nano bowtie-buildLegCat.sh
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=60gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtie-buildTdimLibrary
#PBS -j oe

module load bowtie
cd /N/dc2/scratch/scahan/sandbox_lucia_121515/Floragenex/bowtieTdim_1122015
bowtie-build TdimDenovoCat.fa tdimFloragenex
#mv *.ebwt /N/dc2/scratch/scahan/indexes

> qsub bowtie-buqildLegCat.sh  #job 344947.m1.mason

> nano bowtie_TdimFloragenex.sh # edit T dimidiata alignment to Tdim Index.  
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=120gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTdim
#PBS -j oe

module load bowtie
cd /N/dc2/scratch/scahan/sandbox_lucia_121515/Floragenex/bowtieTdim_1122015
cp ../bowtieTcruzi_102415/unmapped_files/Dorn_Triatomine_*_sequence_1_unmappedforTdim.fq .
cp -r ../indexes/ .
mkdir unmapped_files sam_files mapped_files
for X in *.fq; do bowtie tdimFloragenex $X -S ${X%.*}_tdim.sam --un ${X%.*}_post-map.fq; mv $X ./mapped_files; mv *.sam ./sam_files; mv *_post-map* ./unmapped_files; done
rm -r ./indexes/

> /N/dc2/scratch/scahan/scripts_121515> qsub bowtie_TdimFloragenex.sh #job 344957.m1.mason

##1.29.2016##
[lorantes@h1 Floragenex]$ mkdir bowtieTcruzi_020116
[lorantes@h1 Floragenex]$ mkdir bowtieTdim_020116
[lorantes@h1 bowtieTcruzi_020116]$ pwd
/N/dc2/scratch/scahan/sandbox_lucia_020116/Floragenex/bowtieTcruzi_020116

[lorantes@h1 scripts_020116]> qsub bowtie_TcruziFloragenex.sh 
#submission ID:351610.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=48:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTcruzi_020116
#PBS -j oe

module load bowtie 
cd /N/dc2/scratch/scahan/sandbox_lucia_020116/Floragenex
#mkdir bowtieTcruzi_
cd bowtieTcruzi_020116
cp ../filtered/*.fq .
cp -r ../indexes .
mkdir unmapped_files sam_files Tdim_files mapped_files
for X in *.fq; do echo $X; bowtie AAHK01 $X -S ${X%.*}_AAHK01.sam --un ${X%.*}_unmapped1.fq; mv $X ./mapped_files; bowtie ADWP02 ${X%.*}_unmapped1.fq -S ${X%.*}_ADWP02.sam --un ${X%.*}_unmapped2.fq; bowtie AHKC01 ${X%.*}_unmapped2.fq -S ${X%.*}_AHKC01.sam --un ${X%.*}_unmapped3.fq; bowtie ANOX01 ${X%.*}_unmapped3.fq -S ${X%.*}_ANOX01.sam --un ${X%.*}_unmapped4.fq; bowtie AODP01 ${X%.*}_unmapped4.fq -S ${X%.*}_AODP01.sam --un ${X%.*}_unmapped5.fq; bowtie AQHO01 ${X%.*}_unmapped5.fq -S ${X%.*}_AQHO01.sam --un ${X%.*}_unmapped6.fq; bowtie Other_Tcruzi ${X%.*}_unmapped6.fq -S ${X%.*}_Other-Tcruzi.sam --un ${X%.*}_unmapped7.fq; bowtie TcIV ${X%.*}_unmapped7.fq -S ${X%.*}_TcVI.sam --un ${X%.*}_unmappedforTdim.fq; mv *.sam ./sam_files; mv *_unmappedfor* ./Tdim_files; mv *_unmapped*  ./unmapped_files; done
chmod 777 unmapped_files sam_files Tdim_files mapped_files 

##2.1.2016##
[lorantes@h2 sam_files]$ grep -c "XA" *.sam #count all the sam files from bowtie output.

[lorantes@h1 scripts_020116]$ qsub bowtie_TdimFloragenex.sh 
#submission ID:351610.m1.mason

#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTdim
#PBS -j oe

module load bowtie
cd /N/dc2/scratch/scahan/sandbox_lucia_020116/Floragenex/bowtieTdim_020116
cp ../bowtieTcruzi_020116/Tdim_files/Dorn_Triatomine_*_sequence_1_unmappedforTdim.fq .
cp -r ../indexes/ .
mkdir unmapped_files sam_files mapped_files
for X in *.fq; do bowtie tdimFloragenex $X -S ${X%.*}_tdim.sam --un ${X%.*}_unmappedforBLAST.fq; mv $X ./mapped_files; mv *.sam ./sam_files; mv *_unmappedforBLAST* ./unmapped_files; done
#rm -r ./indexes/

[lorantes@h1 sam_files]$ ls | cut -d "_" -f 3 | uniq> tcruziList.txt # create a file with the names of the unique samples, stripped of any repetitive part of the name. 

##2.3.2016##

[lorantes@h1 scripts_020116]$ qsub bowtie_TdimFloragenex.sh #resubmitted the T. dimidiata bowtie because last pass couldn't copy the filter files to the requested folder. It did run this time. 
#submission ID: 352145.m1.mason

#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTdim
#PBS -j oe

module load bowtie
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/bowtieTdim_020116
cp ../bowtieTcruzi_020116/Tdim_files/Dorn_Triatomine_CHJ52Ab_sequence_1_filtered_unmappedforTdim.fq .
#cp -r ../indexes/ .
#mkdir unmapped_files sam_files mapped_files
for X in *.fq; do bowtie tdimFloragenex $X -S ${X%.*}_tdim.sam --un ${X%.*}_unmappedforBLAST.fq; mv $X ./mapped_files; mv *.sam ./sam_files; mv *_unmappedforBLAST* ./unmapped_files; done
#rm -r ./indexes/

[lorantes@h1 sam_files]$  grep "XA" Dorn_Triatomine_S210Ab_* >S210Ab_Tcruzi.sam #ran this command for all nine samples infected with T. cruzi to create individual files containing only mapped sequences.  

[lorantes@h1 sam_files]$ grep -c "XA" *_Tcruzi.sam #counts the total number of reads for each concatenated file of the infected samples. Counts:

#Infected Sample	Total Reads
#A1215Ab_Tcruzi.sam	56,959
#A9252_Tcruzi.sam	3,406
#A9253_Tcruzi.sam	2,431
#Abdomen5_Tcruzi.sam	2,237
#B46_Tcruzi.sam	138,011
#BS230Ab_Tcruzi.sam	36,293
#CHJ462Ab_Tcruzi.sam	8,610
#CHJ52Ab_Tcruzi.sam	22,406
S210Ab_Tcruzi.sam	1,088,596

[lorantes@h1 scripts_020116]$ qsub ref_map_TcruziFloragenex.sh
#submission ID: 352244.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N RefmapTcruzi_020116
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_020116/Floragenex/refMapTcruzi_020116
cp ../bowtieTcruzi_020116/sam_files/*_Tcruzi.sam .
mkdir outputTcruzi 
ref_map.pl -s A1215Ab_Tcruzi.sam -s A9252_Tcruzi.sam -s A9253_Tcruzi.sam -s Abdomen5_Tcruzi.sam -s B46_Tcruzi.sam -s BS230Ab_Tcruzi.sam -s CHJ462Ab_Tcruzi.sam -s CHJ52Ab_Tcruzi.sam -s S210Ab_Tcruzi.sam -o ./outputTcruzi -n 6 -m 1 -T 8 -S -i 1 -b 1 

[lorantes@h1 BLAST_020116]$ grep -c "HWI" *.fq #count the number of reads for the sequences left for BLAST search

[lorantes@h1 scripts_020116]$ qsub ref_map_TdimFloragenex.sh 
#submission ID: 352484.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N RefmapTdim_020116
#PBS -j oe

module load stacks 
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/refMapTdim_020116
cp ../bowtieTdim_020116/sam_files/*_tdim.sam . 
mkdir ./outputTdim
ref_map.pl -s Dorn_Triatomine_A1215Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_A5201_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_A9252_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_A9253_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Abdomen5_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_B46_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_BS230Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_C1504_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ14_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ21_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ3_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ462Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ462Leg_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ506Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ52Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0074_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0124_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0188_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0225_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0275_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_S134_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_S210Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_S431Leg_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP194_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP838_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-900_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP901_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-903_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-904_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-930_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-937_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim_tdim.sam -o ./outputTdim -n 6 -m 3 -T 8 -S -i 1 -b 1 

##2.4.16##
[lorantes@h2 scripts_020116]$ qsub genotypes_TcruziFloragenex.sh ## grab haplotype output, pass filter and output into encoded genotype for T. cruzi. 
#submission ID: 352701.m1.mason

#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=6:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N genotypes_Tcruzi
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_020116/Floragenex/refMapTcruzi_020116/outputTcruzi
genotypes -b 1 -P ./ -r 1 -m 1 -c -t GEN -o genomic --min_hom_seqs 1 

[lorantes@h2 scripts_020116]$ qsub genotypes_TdimFloragenex.sh #grab haplotype output, pass filter and output into encoded genotype for T. dimidiata.
#submission ID: 352640.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=6:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N genotypes_Tdim
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_020116/Floragenex/refMapTcruzi_020116/outputTdim
genotypes -b 1 -P ./ -r 1 -m 1 -c -t GEN -o genomic 

##2.8.15##
[lorantes@h1 user_library_import_dir]$ mkdir lorantes@indiana.edu
[lorantes@h1 lorantes@indiana.edu]$ pwd
/N/dc2/scratch/iugalaxy/user_library_import_dir/lorantes@indiana.edu #made directory in directory to import to Galaxy for Blast.

##2.16.16##
[lorantes@h1 outputTcruzi]$ wc -l *_Tcruzi.snps.tsv #count number of T. cruzi SNPs per sample 

  995 A1215Ab_Tcruzi.snps.tsv
    7 A9252_Tcruzi.snps.tsv
    9 A9253_Tcruzi.snps.tsv
   35 Abdomen5_Tcruzi.snps.tsv
  456 B46_Tcruzi.snps.tsv
  412 BS230Ab_Tcruzi.snps.tsv
   92 CHJ462Ab_Tcruzi.snps.tsv
  727 CHJ52Ab_Tcruzi.snps.tsv
  938 S210Ab_Tcruzi.snps.tsv
 3671 total
 
[lorantes@h1 outputTdim]$ wc -l Dorn_Triatomine_*_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv # count number of T. dimidiata SNPs per sample
   8302 Dorn_Triatomine_A1215Ab_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3297 Dorn_Triatomine_A5201_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3382 Dorn_Triatomine_A9252_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3035 Dorn_Triatomine_A9253_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3094 Dorn_Triatomine_Abdomen5_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3900 Dorn_Triatomine_B46_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3269 Dorn_Triatomine_BS230Ab_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   2979 Dorn_Triatomine_C1504_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   2506 Dorn_Triatomine_CHJ14_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   1560 Dorn_Triatomine_CHJ21_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   2609 Dorn_Triatomine_CHJ3_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   2841 Dorn_Triatomine_CHJ462Ab_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3599 Dorn_Triatomine_CHJ462Leg_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3400 Dorn_Triatomine_CHJ506Ab_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3663 Dorn_Triatomine_Codigo-0074_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   1116 Dorn_Triatomine_Codigo-0124_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3150 Dorn_Triatomine_Codigo-0188_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   6018 Dorn_Triatomine_Codigo-0225_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   2303 Dorn_Triatomine_Codigo-0275_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   1277 Dorn_Triatomine_S134_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3722 Dorn_Triatomine_S210Ab_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   4877 Dorn_Triatomine_S431Leg_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
     53 Dorn_Triatomine_TP194_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
    608 Dorn_Triatomine_TP838_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   2831 Dorn_Triatomine_TP-900_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3574 Dorn_Triatomine_TP901_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   2848 Dorn_Triatomine_TP-903_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3643 Dorn_Triatomine_TP-904_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3173 Dorn_Triatomine_TP-930_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3160 Dorn_Triatomine_TP-937_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
   3896 Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim_tdim.snps.tsv
  97685 total

[lorantes@h1 outputTcruzi]$ cut -f7 A1215Ab_Tcruzi.matches.tsv | sort -n | tail -1
1884 #cut column 7 from the xx.matches.tsv file, then sort it lowest to highest, then get the last number. This number is the highest depth of coverage for that sample. 
[lorantes@h1 outputTcruzi]$ cut -f7 A1215Ab_Tcruzi.matches.tsv | sort -n | head -1
1 #cut column 7 from the xx.matches.tsv file, then sort it lowest to highest, then get the first number. This number is the lowest depth of coverage for that sample. 

[lorantes@h1 outputTcruzi]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' A9252_Tcruzi.matches.tsv # calculate de average depth of coverage for each sample by using the depth of coverage for each read described in the column N=7 of the XX.matches.tsv file.
8.79581
[lorantes@h1 outputTcruzi]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' A1215Ab_Tcruzi.matches.tsv
13.3007

[lorantes@h1 outputTcruzi]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' A1215Ab_Tcruzi.matches.tsv
13.3007
[lorantes@h1 outputTcruzi]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' A9252_Tcruzi.matches.tsv
8.79581
[lorantes@h1 outputTcruzi]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' A9253_Tcruzi.matches.tsv
8.18519
[lorantes@h1 outputTcruzi]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Abdomen5_Tcruzi.matches.tsv
7.71379
[lorantes@h1 outputTcruzi]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' B46_Tcruzi.matches.tsv
53.0688
[lorantes@h1 outputTcruzi]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' BS230Ab_Tcruzi.matches.tsv
12.2339
[lorantes@h1 outputTcruzi]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' CHJ462Ab_Tcruzi.matches.tsv
4.74064
[lorantes@h1 outputTcruzi]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' CHJ52Ab_Tcruzi.matches.tsv
6.59823
[lorantes@h1 outputTcruzi]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' S210Ab_Tcruzi.matches.tsv
181.961


[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_A1215Ab_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
63.7309
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_A5201_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
233.035
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_A9252_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
104.887
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_A9253_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
100.618
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_Abdomen5_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
72.5751
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_B46_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
158.758
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_BS230Ab_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
109.774
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_C1504_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
73.1496
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_CHJ14_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
66.9097
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_CHJ21_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
37.4016
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_CHJ3_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
74.7277
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_CHJ462Ab_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
86.0236
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_CHJ462Leg_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
116.618
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_CHJ506Ab_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
193.801
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_Codigo-0074_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
56.2394
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_Codigo-0124_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
76.0816
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_Codigo-0188_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
135.35
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_Codigo-0225_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
123.279
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_Codigo-0275_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
61.6758
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_S134_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
34.0061
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_S210Ab_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
110.428
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_S431Leg_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
93.734
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_TP194_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
2196.77
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_TP838_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
49.006
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_TP-900_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
65.2831
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_TP901_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
184.988
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_TP-903_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
60.1415
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_TP-904_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
149.773
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_TP-93_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
awk: cmd. line:1: fatal: cannot open file `Dorn_Triatomine_TP-93_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv' for reading (No such file or directory)
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_TP-930_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
94.4217
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_TP-937_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
194.839
[lorantes@h1 outputTdim]$ awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv
67.8553
________________________________________________________________________________
[lorantes@h2 scripts_020116]$ qsub genotypes_TcruziFloragenex.sh ## grab haplotype output, pass filter and output into encoded genotype for T. cruzi. 
#submission ID: 355318.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=2:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N genotypes_Tcruzi
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_020516/Floragenex/refMapTcruzi_020116/outputTcruzi
genotypes -b 1 -P ./ -r 2 -m 1 --min_hom_seqs 3 -t GEN 

[lorantes@h2 scripts_020116]$ qsub genotypes_TdimFloragenex.sh #grab haplotype output, pass filter and output into encoded genotype for T. dimidiata.
#submission ID: 355322.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=2:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N genotypes_Tdim
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_020516/Floragenex/refMapTdim_020116/outputTdim
genotypes -b 1 -P ./ -r 3 -m 2 --min_hom_seqs 3 -t GEN 

	
[lorantes@h1 scripts_020516]$ qsub haplotypes_to_fasta_Floragenex_Tcruzi.sh # after running Stacks genotypes, use output 'batch_1.haplotypes_1.tsv' to convert haplotypes to unicode then to fasta.

#submission ID: 355887.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=100gb,walltime=2:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N haplotypes_to_fasta_Tcruzi
#PBS -j oe

cd /N/dc2/scratch/scahan/sandbox_lucia_020516/Floragenex/refMapTcruzi_020116/outputTcruzi  
INPUT=batch_1.haplotypes_1.tsv
VAR=batch_1.haplotypes_1_variable.tsv
DIP=batch_1.haplotypes_1_variable2.tsv
AMBIG=batch_1.haplotypes_1_variable2_single.tsv
grep -v "consensus" $INPUT > $VAR
grep -v "\w*/\w*/" $VAR > $DIP
python ~/scripts/haplotype_to_ambig_code.py $DIP
python ~/scripts/SNP_to_sequence_UVM.py $AMBIG

[lorantes@h1 scripts_020516]$ qsub haplotypes_to_fasta_Floragenex_Tdim.sh
#submission ID: 355888.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=100gb,walltime=2:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N haplotypes_to_fasta_Tdim
#PBS -j oe

cd /N/dc2/scratch/scahan/sandbox_lucia_020516/Floragenex/refMapTdim_020116/outputTdim  
INPUT=batch_1.haplotypes_1.tsv
VAR=batch_1.haplotypes_1_variable.tsv
DIP=batch_1.haplotypes_1_variable2.tsv
AMBIG=batch_1.haplotypes_1_variable2_single.tsv
grep -v "consensus" $INPUT > $VAR
grep -v "\w*/\w*/" $VAR > $DIP
python ~/scripts/haplotype_to_ambig_code.py $DIP
python ~/scripts/SNP_to_sequence_UVM.py $AMBIG

## 2.17.2015 ##
#Create filters for genotypes, and re-run it. 
[lorantes@h1 scripts_020516]$ qsub genotypes_TcruziFloragenex.sh 
#submission ID: 355975.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=6:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N genotypes_Tcruzi
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/refMapTcruzi_020116/outputTcruzi
genotypes -b 1 -P ./ -r 2 -m 1 --min_hom_seqs 2 -t GEN

[lorantes@h1 scripts_020516]$ qsub genotypes_TdimFloragenex.sh 
#submission ID: 355977.m1.mason
[lorantes@h1 scripts_020516]$ 
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=6:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N genotypes_Tdim
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/refMapTdim_020116/outputTdim
genotypes -b 1 -P ./ -r 3 -m 1 --min_hom_seqs 3 -t GEN

# make un haplotype file. No changes to the script, just re-ran it. 
[lorantes@h1 scripts_020516]$ qsub haplotypes_to_fasta_Floragenex_Tcruzi.sh
#submission ID: 355979.m1.mason
[lorantes@h1 scripts_020516]$ qsub haplotypes_to_fasta_Floragenex_Tdim.sh
#submission ID: 355980.m1.mason 


##2.18.16##
[lorantes@h2 scripts_020516]$ qsub ambig_to_adegenet_TdimFloragenex.sh #Convert ambiguous file (output from haplotypes_to_fasta script) to adegenet file. 

#submission ID: 358308.m1.mason 
#! /bin/bash
#PBS -k o
#PBS -l nodes=4:ppn=2,vmem=60gb,walltime=2:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N ambig_to_adegenet_Tdim
#PBS -j oe

cd /N/dc2/scratch/scahan/sandbox_lucia_020516/Floragenex/refMapTdim_020116/outputTdim  
INPUT=batch_1.haplotypes_1_variable2_single.tsv
python /N/dc2/scratch/scahan/scripts_020516/make_genotype_file_for_adegenet.py $INPUT

[lorantes@h2 scripts_020516]$ qsub ambig_to_adegenet_TcruziFloragenex.sh 
#submission ID:358309.m1.mason

cd /N/dc2/scratch/scahan/sandbox_lucia_020516/Floragenex/refMapTcruzi_020116/outputTcruzi  
INPUT=batch_1.haplotypes_1_variable2_single.tsv
python /N/dc2/scratch/scahan/scripts_020516/make_genotype_file_for_adegenet.py $INPUT

[lorantes@h2 outputTcruzi]$ sed 's/[N]//g' Floragenex_TcruziHaplotype.fas | awk '{ print length($0) }' #exclude the "N" all character strings, then count the number of characters in each line.

##02.19.2016##

#have to re-run the genotype, haplotypes_to_fasta_Floragenex_Tcruzi.sh and ambig_to_adegenet (no changes to the scripts just re-running for organization). 
[lorantes@h2 scripts_020516]$ qsub genotypes_TcruziFloragenex.sh 
#submission ID:358764.m1.mason
[lorantes@h2 scripts_020516]$ qsub genotypes_TdimFloragenex.sh 
#submission ID:358865.m1.mason
[lorantes@h2 scripts_020516]$ qsub haplotypes_to_fasta_Floragenex_Tcruzi.sh
#submission ID:358866.m1.mason
[lorantes@h2 scripts_020516]$ qsub ambig_to_adegenet_TcruziFloragenex.sh 
#submission ID:358869.m1.mason
[lorantes@h2 scripts_020516]$ qsub haplotypes_to_fasta_Floragenex_Tdim.sh
#submission ID:358870.m1.mason
[lorantes@h2 scripts_020516]$ qsub ambig_to_adegenet_TdimFloragenex.sh
#submission ID:358872.m1.mason
[lorantes@h2 scripts_020516]$ qsub haplotypes_to_fasta_Floragenex_Tdim.sh
#submission ID:358870.m1.mason
[lorantes@h2 scripts_020516]$ qsub ambig_to_adegenet_TdimFloragenex.sh
#submission ID:358872.m1.mason

#Move Floragenex files to the repository
[lorantes@h1 scripts_022016]$ qsub copy_to_repository_Lucia.sh 
#submission ID: 359507.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=120gb,walltime=6:00:00
#PBS -M lorantes@uvm.edu        
#PBS -m abe
#PBS -N cpRepo
#PBS -j oe

cd /N/dc2/scratch/scahan/sandbox_lucia_022016/
cp -r ./Floragenex_2016 ~

outpuTcruzi/sftp> get batch_*.tsv ./Desktop/Floragenex_Tcruzi_2016 #export all the batch files from the T. cruziref_map  
outpuTcruzi/sftp> get Floragenex_* ./Desktop/Floragenex_Tcruzi_2016 #export the final .snp and .fas files containing the genotypes for each T. cruzi sample. 

outpuTdim/sftp> get batch_*.tsv ./Desktop/Floragenex_Tdim_2016 #export all the batch files from the T. dimidiata ref_map 
outpuTdim/sftp> get Floragenex_* ./Desktop/Floragenex_Tdim_2016 #export the final .snp and .fas files containing the genotypes for each T. dimidiata sample. 

##02.21.2016##
#T dimidiata#
[lorantes@h1 outputTdim]$ awk '{ print length($0) }' Floragenex_TdimHaplotype.fas #count number of characters in each line
64
58282
69
58282
64
58282
63
58282
64
58282
62
58282
64
58282
69
58282
64
58282
66
58282
63
58282
65
58282
63
58282
65
58282
63
58282
69
58282
63
58282
63
58282
63
58282
63
58282
66
58282
64
58282
61
58282
64
58282
62
58282
63
58282
69
58282
66
58282
69
58282
67
58282
65
58282
[lorantes@h1 outputTdim]$ sed 's/[N]//g' Floragenex_TdimHaplotype.fas | awk '{ print length($0) }' #count number of characters that are NOT N.
64
30969
69
31818
64
31720
63
28250
64
30104
62
29282
64
30501
69
31418
64
31538
66
28323
63
30368
65
30034
63
35603
65
34837
63
5431
69
18102
63
29391
63
23496
63
29721
63
355
66
13400
64
31309
61
32103
64
32650
62
20653
63
31598
69
27748
66
31413
69
30242
67
36011
65
30914
[lorantes@h1 outputTdim]$ grep ">" Floragenex_TdimHaplotype.fas #list the order of samples in final fasta file.
>Dorn_Triatomine_TP-903_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_Codigo-0225_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_S210Ab_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_CHJ14_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_CHJ3_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_TP-900_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_Codigo-0188_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_TP-930_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_CHJ462Ab_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_A9252_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_BS230Ab_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_TP901_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_A1215Ab_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_TP838_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_Codigo-0124_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_C1504_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_CHJ21_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_A9253_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_TP194_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_CHJ506Ab_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_TP-937_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_B46_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_TP-904_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_S134_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_A5201_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_Codigo-0275_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_Abdomen5_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_Codigo-0074_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_CHJ462Leg_sequence_1_filtered_unmappedforTdim_tdim
>Dorn_Triatomine_S431Leg_sequence_1_filtered_unmappedforTdim_tdim

#T cruzi#
[lorantes@h1 outputTcruzi]$ awk '{ print length($0) }' Floragenex_TcruziHaplotype.fas 
11
6405
14
6405
15
6405
16
6405
15
6405
13
6405
16
6405
13
6405
15
6405
[lorantes@h1 outputTcruzi]$ sed 's/[N]//g' Floragenex_TcruziHaplotype.fas | awk '{ print length($0) }'
11
2877
14
4557
15
5323
16
1734
15
4492
13
313
16
275
13
355
15
2553
[lorantes@h1 outputTcruzi]$ grep ">" Floragenex_TcruziHaplotype.fas 
>B46_Tcruzi
>S210Ab_Tcruzi
>A1215Ab_Tcruzi
>CHJ462Ab_Tcruzi
>CHJ52Ab_Tcruzi
>A9253_Tcruzi
>Abdomen5_Tcruzi
>A9252_Tcruzi
>BS230Ab_Tcruzi

##02.22.2016##
#list of T. cruzi samples for populations txt. 
A1215Ab_Tcruzi  A9253_Tcruzi     B46_Tcruzi      CHJ462Ab_Tcruzi  
A9252_Tcruzi    Abdomen5_Tcruzi  BS230Ab_Tcruzi  CHJ52Ab_Tcruzi   S210Ab_Tcruzi

#list of T. dimidiata samples for population txt.
Dorn_Triatomine_A1215Ab_sequence_1_filtered_unmappedforTdim_tdim      Dorn_Triatomine_Codigo-0188_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_A5201_sequence_1_filtered_unmappedforTdim_tdim        Dorn_Triatomine_Codigo-0225_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_A9252_sequence_1_filtered_unmappedforTdim_tdim        Dorn_Triatomine_Codigo-0275_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_A9253_sequence_1_filtered_unmappedforTdim_tdim        Dorn_Triatomine_S134_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_Abdomen5_sequence_1_filtered_unmappedforTdim_tdim     Dorn_Triatomine_S210Ab_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_B46_sequence_1_filtered_unmappedforTdim_tdim          Dorn_Triatomine_S431Leg_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_BS230Ab_sequence_1_filtered_unmappedforTdim_tdim      Dorn_Triatomine_TP194_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_C1504_sequence_1_filtered_unmappedforTdim_tdim        Dorn_Triatomine_TP838_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_CHJ14_sequence_1_filtered_unmappedforTdim_tdim        Dorn_Triatomine_TP-900_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_CHJ21_sequence_1_filtered_unmappedforTdim_tdim        Dorn_Triatomine_TP901_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_CHJ3_sequence_1_filtered_unmappedforTdim_tdim         Dorn_Triatomine_TP-903_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_CHJ462Ab_sequence_1_filtered_unmappedforTdim_tdim     Dorn_Triatomine_TP-904_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_CHJ462Leg_sequence_1_filtered_unmappedforTdim_tdim    Dorn_Triatomine_TP-930_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_CHJ506Ab_sequence_1_filtered_unmappedforTdim_tdim     Dorn_Triatomine_TP-937_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_Codigo-0074_sequence_1_filtered_unmappedforTdim_tdim  Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim_tdim
Dorn_Triatomine_Codigo-0124_sequence_1_filtered_unmappedforTdim_tdim  


##02.24.2016##

test of cross-validation-(example in the Excele file is a G test of heterogeneity. 
Null hypothesis is that there is no correlation between infection status that is determined by the two methods. High significance represents correlation between the methods. The errors are in microscopy but not in RadSeq. 

Get Pi from the Population output to create argument about diversity vs. reads. 

Run fishers exact probability to test lack of correlation between infection status. 

##03.02.2016##
[lorantes@h2 scripts_022016]$ qsub fastq_to_fasta_Floragenex.sh #convert the unmapped files for BLASTA search from .fq to .fasta. 
#submission ID: 362494.m1.mason

#! /bin/bash
#PBS -k o
#PBS -l nodes=4:ppn=2,vmem=80gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N fastq-to-fasta_Floragenex
#PBS -j oe

FASTX=/N/soft/mason/galaxy-apps/fastx_toolkit_0.0.13/fastq_to_fasta
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/BLAST_020116
mkdir fasta_files
for X in *.fq; do $FASTX -Q33 -i $X -o ${X%filtered*}filtered_forBlast.fasta; mv *.fasta ./fasta_files/; done

[lorantes@h2 scripts_022016]$ cd ../ #collapse .fasta files to keep only unique sequences for BLAST search. 
#submission ID: 362495.m1.mason 

#! /bin/bash
#PBS -k o
#PBS -l nodes=4:ppn=2,vmem=80gb,walltime=6:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N fastx_collapser_Floragenex
#PBS -j oe

FASTX=/N/soft/mason/galaxy-apps/fastx_toolkit_0.0.13/fastx_collapser
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/BLAST_020116/fasta_files/
mkdir collapsed
for X in *.fasta; do $FASTX  -i $X -o ${X%.*}_collapsed.fasta; mv *_collapsed.fasta ./collapsed/; done

##3.4.2016##
/N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/bowtieTcruziIndividual_0304016 #folder for samples that will map fully to each genome
/N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/bowtieTcruziSequence_0304016 #directory for samples that will map sequentially to each genome. 

#Create T. cruzi batch that iterates through each genome individually with full raw count in each mapping loop.
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=48:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTcruzi_020116
#PBS -j oe

module load bowtie 
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/bowtieTcruziIndividual_0304016
cp ../filtered/Dorn_Triatomine_A1215Ab_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_A9252_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_A9253_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_Abdomen5_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_B46_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_BS230Ab_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_CHJ462Ab_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_CHJ52Ab_sequence_filtered.fq .
cp ../filtered/Dorn_Triatomine_S210Ab_sequence_1_filtered.fq .
cp -r ../indexes .
mkdir unmapped_files sam_files
for X in *_filtered.fq; do echo $X; bowtie AAHK01 $X -S ${X%.*}_AAHK01.sam --un ${X%.*}_unmapped1.fq; bowtie ADWP02 $X -S ${X%.*}_ADWP02.sam --un ${X%.*}_unmapped2.fq; bowtie AHKC01 $X -S ${X%.*}_AHKC01.sam --un ${X%.*}_unmapped3.fq; bowtie ANOX01 $X -S ${X%.*}_ANOX01.sam --un ${X%.*}_unmapped4.fq; bowtie AODP01 $X -S ${X%.*}_AODP01.sam --un ${X%.*}_unmapped5.fq; bowtie AQHO01 $X -S ${X%.*}_AQHO01.sam --un ${X%.*}_unmapped6.fq; bowtie Other_Tcruzi $X -S ${X%.*}_Other-Tcruzi.sam --un ${X%.*}_unmapped7.fq; bowtie TcIV $X -S ${X%.*}_TcVI.sam --un ${X%.*}_unmapped8.fq; mv *.sam ./sam_files; mv *_unmapped*  ./unmapped_files; done
chmod 777 unmapped_files sam_files
rm -r indexes

[lorantes@h1 scripts_022016]$ qsub bowtie_TcruziIndivFloragenex.sh 
#submission ID: 363012.m1.mason

#Create T. cruzi batch that iterates through each genome, mapping the most reads with the first genome.
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=48:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTcruziSeq_030416
#PBS -j oe

module load bowtie 
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/bowtieTcruziSequence_0304016
cp ../filtered/Dorn_Triatomine_A1215Ab_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_A9252_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_A9253_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_Abdomen5_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_B46_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_BS230Ab_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_CHJ462Ab_sequence_1_filtered.fq .
cp ../filtered/Dorn_Triatomine_CHJ52Ab_sequence_filtered.fq .
cp ../filtered/Dorn_Triatomine_S210Ab_sequence_1_filtered.fq .
cp -r ../indexes .
mkdir unmapped_files sam_files Tdim_files mapped_files
for X in *.fq; do echo $X; bowtie AODP01 $X -S ${X%.*}_AODP01.sam --un ${X%.*}_unmapped1.fq; mv $X ./mapped_files; bowtie ADWP02 ${X%.*}_unmapped1.fq -S ${X%.*}_ADWP02.sam --un ${X%.*}_unmapped2.fq; bowtie ANOX01 ${X%.*}_unmapped2.fq -S ${X%.*}_ANOX01.sam --un ${X%.*}_unmapped3.fq; bowtie AAHK01 ${X%.*}_unmapped3.fq -S ${X%.*}_AAHK01.sam --un ${X%.*}_unmapped4.fq; bowtie AQHO01 ${X%.*}_unmapped4.fq -S ${X%.*}_AQHO01.sam --un ${X%.*}_unmapped5.fq; bowtie AHKC01 ${X%.*}_unmapped5.fq -S ${X%.*}_AHKC01.sam --un ${X%.*}_unmapped6.fq; bowtie Other_Tcruzi ${X%.*}_unmapped6.fq -S ${X%.*}_Other-Tcruzi.sam --un ${X%.*}_unmapped7.fq; bowtie TcIV ${X%.*}_unmapped7.fq -S ${X%.*}_TcVI.sam --un ${X%.*}_unmappedforTdim.fq; mv *.sam ./sam_files; mv *_unmappedfor* ./Tdim_files; mv *_unmapped*  ./unmapped_files; done
chmod 777 unmapped_files sam_files Tdim_files mapped_files
rm -r indexes

#Genome accession codes and looping order:
#AODP01 - TcI
#ADWP02 - TcI,
#ANOX01 - TcII,
#AAHK01 - TcVI 
#AQHO01 - TcVI, 
#AHKC0  - TcBat

# To get a filtered leg catalog fasta file:
# after running denovo.pl, run genotypes with the appropriate -r flag (I typically use a value of 50% of the samples, so for 24 legs the flag would be -r 12).  

[lorantes@h1 scripts_022016]$ qsub genotypes_TdimFloragenex.sh 
#JobID: 363426.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=6:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N genotypes_TdimDenovo
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/legDenovo 
genotypes -b 1 -P ./ -r 6 -m 1 --min_hom_seqs 3 -t GEN 

#As usual, nano the haplotypes file to remove the space between Catalog and ID on the header line.

#Select all the consensus tags from the resulting haplotypes file and put them in your tag list:
[lorantes@h2 outputTdim]$ grep "consensus" batch_1.haplotypes_1.tsv | cut -f 1 > taglist.txt

#Now filter the variable tags to get rid of those with >2 haplotypes and too many SNPs (I use 3 for closely related taxa, and 6 for more distant ones - try 6 and see how many tags you get).  Edit the Filter_taxaNUM_SNPnum_Chagas.py script for these two values (a few lines before the end is the line, has a comment to indicate where to edit), then use:
[lorantes@h2 scripts022016] python Filtering_taxaNUM_SNPnum_Chagas.py ../sandbox_lucia_022016/Floragenex_2016/legDenovo/batch_1.haplotypes_6.tsv

#This will produce a *_filter.tsv file.  Get the IDs of those tags and add them to your taglist:
cut -f 1 batch_1.haplotypes_6_filter.tsv >> taglist.txt

#Make a complete tag list from the batch_1.catalog.tags.tsv file with just tag ID and sequence:
cut -f 3,10 batch_1.catalog.tags.tsv > sequences.txt

#Make a tab file of the sequences corresponding to your taglist (note - the space after $X is made by typing ctrl-v tab):
for X in `cat taglist.txt`; do grep "^$X	" sequences.txt >> leg_catalog.tab ; done

#Check that the number of lines in the taglist.txt and leg_catalog.tab are the same - if not, the grep command is not identifying the numbers in full and is grepping extra lines. 

wc -l taglist.txt 6207
wc -l leg_catalog.tab 6206
 
#Run make_fasta.py to convert the tab file to a fasta file:
[lorantes@h1 scripts_022016]$ python make_fasta.py ../sandbox_lucia_022016/Floragenex_2016/legDenovo/leg_catalog.tab

##03.09.16##

File: bowtie-buildLegCat.sh  # make index form leg catalog 
#submission ID: 364017.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=60gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtie-buildTdimLibrary
#PBS -j oe

module load bowtie
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/legDenovo
bowtie-build leg_catalog.fas tdimFloragenex
mv *.ebwt ../indexes


File: bowtie_TdimFloragenex.sh # edit T dimidiata alignment to Tdim Index.  
#submission ID: 364021.m1.mason

#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=120gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieTdim
#PBS -j oe

module load bowtie
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/bowtieTdim_020116
cp ../bowtieTcruzi_020116/Tdim_files/*.fq .
cp -r ../indexes/ .
#mkdir unmapped_files sam_files mapped_files
for X in *.fq; do bowtie tdimFloragenex $X -S ${X%.*}_tdim.sam --un ${X%.*}_post-map.fq; mv $X ./mapped_files; mv *.sam ./sam_files; mv *_post-map* ./unmapped_files; done
rm -r ./indexes/

#run ref map for legs
[lorantes@h1 scripts_020116]$ qsub ref_map_TdimFloragenex.sh 
#submission ID: 

#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N RefmapTdim_020116
#PBS -j oe

module load stacks 
cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/refMapTdim_020116
cp ../bowtieTdim_020116/sam_files/*_tdim.sam . 
mkdir ./outputTdim
ref_map.pl -s Dorn_Triatomine_A1215Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_A5201_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_A9252_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_A9253_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Abdomen5_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_B46_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_BS230Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_C1504_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ14_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ21_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ3_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ462Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ462Leg_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ506Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_CHJ52Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0074_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0124_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0188_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0225_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_Codigo-0275_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_S134_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_S210Ab_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_S431Leg_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP194_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP838_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-900_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP901_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-903_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-904_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-930_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-937_sequence_1_filtered_unmappedforTdim_tdim.sam -s Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim_tdim.sam -o ./outputTdim -n 6 -m 1 -T 8 -S -i 1 -b 1 


#run taxaNum filter for Tcruzi 
#Select all the consensus tags from the resulting haplotypes file and put them in your tag list:
[lorantes@h2 outputTdim]$ grep "consensus" batch_1.haplotypes_1.tsv | cut -f 1 > taglist.txt

#Now filter the variable tags to get rid of those with >2 haplotypes and too many SNPs (I use 3 for closely related taxa, and 6 for more distant ones - try 6 and see how many tags you get).  Edit the Filter_taxaNUM_SNPnum_Chagas.py script for these two values (a few lines before the end is the line, has a comment to indicate where to edit), then use:  
python ../../../../scripts_022016/Filtering_taxaNUM_SNPnum_Chagas.py ./batch_1.haplotypes_1.tsv

# make Tcruzi haplotype file.  
[lorantes@h1 scripts_020516]$ qsub haplotypes_to_fasta_Floragenex_Tcruzi.sh
#submission ID: 364022.m1.mason

#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=2:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N haplotypes_to_fasta_Tcruzi
#PBS -j oe

cd /N/dc2/scratch/scahan/sandbox_lucia_022016/Floragenex_2016/refMapTcruzi_020116/outputTcruzi 
INPUT=batch_1.haplotypes_1_filter.tsv
VAR=batch_1.haplotypes_1_variable.tsv
DIP=batch_1.haplotypes_1_variable2.tsv
AMBIG=batch_1.haplotypes_1_variable2_single.tsv
grep -v "consensus" $INPUT > $VAR
grep -v "\w*/\w*/" $VAR > $DIP
python ~/scripts/haplotype_to_ambig_code.py $DIP
python ~/scripts/SNP_to_sequence_UVM.py $AMBIG

File: ambig_to_adegenet_TcruziFloragenex.sh #Convert ambiguous file (output from haplotypes_to_fasta script) to adegenet file. 
#submission ID: 364023.m1.mason

[lorantes@h2 outputTcruzi]$ awk '{ print length($0) }' Floragenex_TcruziHaplotype_Filtered.fas 
11
790
14
790
15
790
16
790
15
790
13
790
16
790
13
790
15
790
[lorantes@h2 outputTcruzi]$ sed 's/[N]//g' Floragenex_TcruziHaplotype_Filtered.fas | awk '{ print length($0) }'
11
714
14
790
15
790
16
735
15
783
13
135
16
85
13
186
15
789
[lorantes@h2 outputTcruzi]$ grep ">" Floragenex_TcruziHaplotype_Filtered.fas 
>B46_Tcruzi
>S210Ab_Tcruzi
>A1215Ab_Tcruzi
>CHJ462Ab_Tcruzi
>CHJ52Ab_Tcruzi
>A9253_Tcruzi
>Abdomen5_Tcruzi
>A9252_Tcruzi
>BS230Ab_Tcruzi

##3.14.2015##
[lorantes@h2 scripts_031016]$ qsub genotypes_TdimFloragenex.sh 
#submission ID:364916.m1.mason
/N/dc2/scratch/scahan/sandbox_lucia_031016/Floragenex_2016/refMapTdim_020116/outputTdim

[lorantes@h2 scripts_031016]$ qsub haplotypes_to_fasta_Floragenex_Tdim.sh
#submission ID:364917.m1.mason

[lorantes@h2 scripts_031016]$ qsub ambig_to_adegenet_TdimFloragenex.sh
#submission ID:364918.m1.mason

[lorantes@h1 outputTcruzi]$ grep "loci" ref_map.log #obtain the number of loci and stacks from the ref_map log. 
  Merged 13337 unique Stacks into 3360 loci.
  Wrote 3360 loci, excluded 0 loci due to insuffient depth of coverage; blacklisted 0 loci.
  Merged 422 unique Stacks into 378 loci.
  Wrote 378 loci, excluded 0 loci due to insuffient depth of coverage; blacklisted 0 loci.
  Merged 326 unique Stacks into 289 loci.
  Wrote 289 loci, excluded 0 loci due to insuffient depth of coverage; blacklisted 0 loci.
  Merged 318 unique Stacks into 274 loci.
  Wrote 274 loci, excluded 0 loci due to insuffient depth of coverage; blacklisted 0 loci.
  Merged 4471 unique Stacks into 2220 loci.
  Wrote 2220 loci, excluded 0 loci due to insuffient depth of coverage; blacklisted 0 loci.
  Merged 3974 unique Stacks into 2625 loci.
  Wrote 2625 loci, excluded 0 loci due to insuffient depth of coverage; blacklisted 0 loci.
  Merged 2106 unique Stacks into 1749 loci.
  Wrote 1749 loci, excluded 0 loci due to insuffient depth of coverage; blacklisted 0 loci.
  Merged 8000 unique Stacks into 2825 loci.
  Wrote 2825 loci, excluded 0 loci due to insuffient depth of coverage; blacklisted 0 loci.
  Merged 24437 unique Stacks into 5153 loci.
  Wrote 5153 loci, excluded 0 loci due to insuffient depth of coverage; blacklisted 0 loci.

[lorantes@h1 outputTdim]$ for X in Dorn_Triatomine_*_sequence_1_filtered_unmappedforTdim_tdim.matches.tsv; do awk -v N=7 '{ sum += $N } END { if (NR > 0) print sum / NR }' $X; done #loop to obtain the average depth of coverage for each sample. 

87.6765
297.506
131.738
122.043
91.3651
206.449
131.602
82.4647
78.2208
41.536
88.076
98.051
222.81
6.19965
106.225
134.073
26.527
180.516
110.583
82.8219
32.8555
135.526
194.934
4.42857
99.2748
78.4415
285.933
81.7065
217.808
126.083
244.985
77.5544

##3.15.16##
#run Stacks Populations to get population genetics statistics among (1) all individuals and (2) DAPC clusters. 
[lorantes@h2 scripts_031016]$ qsub populations_TdimFloragenex_DAPC.sh
sub ID: 365502.m1.mason

#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N RefmapTdim_020116
#PBS -j oe

module load stacks 
cd /N/dc2/scratch/scahan/sandbox_lucia_031016/Floragenex_2016/refMapTdim_020116/outputTdim 

populations -P ./ -M ./PopMapCluster.txt -b 1 -S -t 16 -i 1 -p 3 -m 3 -f p_value

>nano PopMapDAPC.txt 
Dorn_Triatomine_A1215Ab_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_A5201_sequence_1_filtered_unmappedforTdim_tdim	1
Dorn_Triatomine_A9252_sequence_1_filtered_unmappedforTdim_tdim	2
Dorn_Triatomine_A9253_sequence_1_filtered_unmappedforTdim_tdim	2
Dorn_Triatomine_B46_sequence_1_filtered_unmappedforTdim_tdim	2
Dorn_Triatomine_BS230Ab_sequence_1_filtered_unmappedforTdim_tdim	1
Dorn_Triatomine_C1504_sequence_1_filtered_unmappedforTdim_tdim	5
Dorn_Triatomine_CHJ14_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_CHJ21_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_CHJ3_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_CHJ462Leg_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_CHJ506Ab_sequence_1_filtered_unmappedforTdim_tdim	5
Dorn_Triatomine_CHJ52Ab_sequence_1_filtered_unmappedforTdim_tdim	5
Dorn_Triatomine_Codigo-0074_sequence_1_filtered_unmappedforTdim_tdim	5
Dorn_Triatomine_Codigo-0124_sequence_1_filtered_unmappedforTdim_tdim	5
Dorn_Triatomine_Codigo-0188_sequence_1_filtered_unmappedforTdim_tdim	1
Dorn_Triatomine_Codigo-0225_sequence_1_filtered_unmappedforTdim_tdim	5
Dorn_Triatomine_Codigo-0275_sequence_1_filtered_unmappedforTdim_tdim	5
Dorn_Triatomine_S134_sequence_1_filtered_unmappedforTdim_tdim	5
Dorn_Triatomine_S210Ab_sequence_1_filtered_unmappedforTdim_tdim	5
Dorn_Triatomine_S431Leg_sequence_1_filtered_unmappedforTdim_tdim	5
Dorn_Triatomine_TP-900_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP901_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP-903_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP-904_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP-930_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP-937_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim_tdim	3

##3.16.16##
[lorantes@h1 outputTdim]$ cut -f21 batch_1.sumstats_summary.tsv 
# Variant positions
Pi
0.0853209
0.0985597
0.0921973
0.157397
0.164773
# All positions (variant and fixed)
StdErr
4.5785e-05
5.05605e-05
4.63264e-05
6.06492e-05
5.83048e-05
[lorantes@h1 outputTdim]$ cut -f15 batch_1.sumstats_summary.tsv 
# Variant positions
Exp Het
0.0675912
0.077709
0.0826164
0.12913
0.147358
# All positions (variant and fixed)
StdErr
4.19157e-05
4.86272e-05
3.11675e-05
4.7683e-05
3.48506e-05
[lorantes@h1 outputTdim]$ cut -f12 batch_1.sumstats_summary.tsv 
# Variant positions
Obs Hom
0.955208
0.943818
0.959448
0.934195
0.936637
# All positions (variant and fixed)
StdErr
3.79892e-05
4.18512e-05
3.55901e-05
4.85371e-05
4.28323e-05
[lorantes@h2 outputTdim]$ cut -f9 batch_1.sumstats_summary.tsv 
# Variant positions
Obs Het
0.0447921
0.056182
0.040552
0.0658049
0.0633635
# All positions (variant and fixed)
StdErr
0.00104344
0.00110473
0.00222936
0.00176161
0.00310019

 ##4.18.16##
 > qsub  bowtie_IridVirusVIFloragenex.sh #submit a job to run bowtie and align all filtered reads to the Irid Virus VI index. 
#ID Number: 376226.m1.mason

#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=120gb,walltime=24:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N bowtieIridVirus
#PBS -j oe

module load bowtie
cd /N/dc2/scratch/scahan/sandbox_lucia_040116/Floragenex_2016/IridVirusVI
cp ../filtered/*.fq .
cp -r ../indexes/ .
mkdir unmapped_files sam_files mapped_files
for X in *.fq; do echo $X; bowtie Irid-virus-VI $X -S ${X%.*}_IridVirusVI.sam --un ${X%.*}_unmapped.fq; mv $X ./mapped_files; mv *.sam ./sam_files; mv *_unmapped*  ./unmapped_files; done
rm -r indexes/
chmod 777 unmapped_files sam_files mapped_files

##4.19.16##
[lorantes@h1 sam_files]$ for X in *.sam; do echo $X; grep "XA" $X -S ${X%.*}_IridVirusVI.sam --un ${X%.*}_unmapped.fq; mv $X ./mapped_files; mv *.sam ./sam_files; mv *_unmapped*  ./unmapped_files; done 

grep "XA" Dorn_Triatomine_S210Ab_* >S210Ab_Tcruzi.sam #ran this command for all nine samples infected with T. cruzi to create individual files containing only mapped sequences.  

[lorantes@h1 sam_files]$ grep -c "XA" *_Tcruzi.sam #counts the total number of reads for each concatenated file of the infected samples. Counts:

#Infected Sample	Total Reads
#A1215Ab_Tcruzi.sam	56,959
#A9252_Tcruzi.sam	3,406
#A9253_Tcruzi.sam	2,431
#Abdomen5_Tcruzi.sam	2,237
#B46_Tcruzi.sam	138,011
#BS230Ab_Tcruzi.sam	36,293
#CHJ462Ab_Tcruzi.sam	8,610
#CHJ52Ab_Tcruzi.sam	22,406
S210Ab_Tcruzi.sam	1,088,596

[lorantes@h1 scripts_020116]$ qsub ref_map_TcruziFloragenex.sh
#submission ID: 352244.m1.mason
#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=12:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N RefmapTcruzi_020116
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_020116/Floragenex/refMapTcruzi_020116
cp ../bowtieTcruzi_020116/sam_files/*_Tcruzi.sam .
mkdir outputTcruzi 
ref_map.pl -s A1215Ab_Tcruzi.sam -s A9252_Tcruzi.sam -s A9253_Tcruzi.sam -s Abdomen5_Tcruzi.sam -s B46_Tcruzi.sam -s BS230Ab_Tcruzi.sam -s CHJ462Ab_Tcruzi.sam -s CHJ52Ab_Tcruzi.sam -s S210Ab_Tcruzi.sam -o ./outputTcruzi -n 6 -m 1 -T 8 -S -i 1 -b 1 

[lorantes@h1 BLAST_020116]$ 

grep -c "HWI" *.fq #count the number of reads for the sequences left for BLAST search

##5.9.16##
[lorantes@h2 fetchTaxa]for X in *_expanded.tsv; do grep "Metazoa" $X > ${X%_expanded}_metazoa.tsv; done & #fet a file that has data only for "Metazoa", did the same with "Virus" and "Bacteria". 
[lorantes@h2 fetchTaxa]$ cat *_expanded.tsv | cut -f 3 -d "," | sort | uniq > masterlist.txt & #create a masterlist with the unique taxa in all the fetched lists.
[lorantes@h2 fetchTaxa]$ for X in *_expanded.tsv; do cut -f 3 -d "," $X | sort | uniq -c > ${X%_expanded}_counted.tsv ; done & #counts how many times a taxa happens in the expanded fetched file. 
[lorantes@h2 fetchTaxa]$ for X in *_counted.tsv; do sed -i 's/^ *//' $X; done & #remove the front space of the list.
[lorantes@h2 fetchTaxa]]$ for X in *_counted.tsv; do sed -r 's/\s+/,/' $X > ${X%_expanded}_counted.csv ; done & #change space to comma, then convert to .csv
[lorantes@h2 sandbox_lucia_050116]$ awk -F "," -v OFS="," '
 FNR==1 {samples[++fni]=FILENAME}
 {if (!taxakeys[$2]) {taxakeys[$2]=1; taxas[++ti]=$2};frequencies[samples[fni],$2]+=$1}
 END {
   printf("Sample"); for (j=1;j<=ti;j++) { printf("%s%s",OFS,taxas[j])}; printf("\n") 
   for (i=1; i<=fni; i++) {
     printf("%s",samples[i]); for (j=1;j<=ti;j++) { printf("%s%d",OFS,frequencies[samples[i],taxas[j]])}; printf("\n")
   }
 }' *_counted.csv>fetchTable_Floragenex.csv #take all the count files, then take the unique names of all files, and assigned the count number to each sample. 
 
 ####11.14.2016####
 
#run Stacks Populations to get population genetics statistics among 

#(1) all individuals
Dorn_Triatomine_A1215Ab_sequence_1_filtered_unmappedforTdim_tdim	1
Dorn_Triatomine_A5201_sequence_1_filtered_unmappedforTdim_tdim	2
Dorn_Triatomine_A9252_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_A9253_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_B46_sequence_1_filtered_unmappedforTdim_tdim	5
Dorn_Triatomine_BS230Ab_sequence_1_filtered_unmappedforTdim_tdim	6
Dorn_Triatomine_C1504_sequence_1_filtered_unmappedforTdim_tdim	7
Dorn_Triatomine_CHJ14_sequence_1_filtered_unmappedforTdim_tdim	8
Dorn_Triatomine_CHJ21_sequence_1_filtered_unmappedforTdim_tdim	9
Dorn_Triatomine_CHJ3_sequence_1_filtered_unmappedforTdim_tdim	10
Dorn_Triatomine_CHJ462Leg_sequence_1_filtered_unmappedforTdim_tdim	11
Dorn_Triatomine_CHJ462Ab_sequence_1_filtered_unmappedforTdim_tdim	12
Dorn_Triatomine_CHJ506Ab_sequence_1_filtered_unmappedforTdim_tdim	13
Dorn_Triatomine_CHJ52Ab_sequence_1_filtered_unmappedforTdim_tdim	14
Dorn_Triatomine_Codigo-0074_sequence_1_filtered_unmappedforTdim_tdim	15
Dorn_Triatomine_Codigo-0124_sequence_1_filtered_unmappedforTdim_tdim	16
Dorn_Triatomine_Codigo-0188_sequence_1_filtered_unmappedforTdim_tdim	17
Dorn_Triatomine_Codigo-0225_sequence_1_filtered_unmappedforTdim_tdim	18
Dorn_Triatomine_Codigo-0275_sequence_1_filtered_unmappedforTdim_tdim	19
Dorn_Triatomine_S134_sequence_1_filtered_unmappedforTdim_tdim	20
Dorn_Triatomine_S210Ab_sequence_1_filtered_unmappedforTdim_tdim	21
Dorn_Triatomine_S431Leg_sequence_1_filtered_unmappedforTdim_tdim	22
Dorn_Triatomine_TP-900_sequence_1_filtered_unmappedforTdim_tdim	23
Dorn_Triatomine_TP901_sequence_1_filtered_unmappedforTdim_tdim	24
Dorn_Triatomine_TP-903_sequence_1_filtered_unmappedforTdim_tdim	25
Dorn_Triatomine_TP-904_sequence_1_filtered_unmappedforTdim_tdim	26
Dorn_Triatomine_TP-930_sequence_1_filtered_unmappedforTdim_tdim	27
Dorn_Triatomine_TP-937_sequence_1_filtered_unmappedforTdim_tdim	28
Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim_tdim	29
 
#(2) DAPC clusters 
Dorn_Triatomine_A1215Ab_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_A5201_sequence_1_filtered_unmappedforTdim_tdim	1
Dorn_Triatomine_A9252_sequence_1_filtered_unmappedforTdim_tdim	2
Dorn_Triatomine_A9253_sequence_1_filtered_unmappedforTdim_tdim	2
Dorn_Triatomine_B46_sequence_1_filtered_unmappedforTdim_tdim	2
Dorn_Triatomine_BS230Ab_sequence_1_filtered_unmappedforTdim_tdim	1
Dorn_Triatomine_C1504_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_CHJ14_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_CHJ21_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_CHJ3_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_CHJ462Leg_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_CHJ462Ab_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_CHJ506Ab_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_CHJ52Ab_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_Codigo-0074_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_Codigo-0124_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_Codigo-0188_sequence_1_filtered_unmappedforTdim_tdim	1
Dorn_Triatomine_Codigo-0225_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_Codigo-0275_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_S134_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_S210Ab_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_S431Leg_sequence_1_filtered_unmappedforTdim_tdim	4
Dorn_Triatomine_TP-900_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP901_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP-903_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP-904_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP-930_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP-937_sequence_1_filtered_unmappedforTdim_tdim	3
Dorn_Triatomine_TP-939_sequence_1_filtered_unmappedforTdim_tdim	3

#create whitelist 
cut –f 1 batch_1.haplotypes_1_variable.tsv > Whitelist.txt

#[lorantes@h1 scripts_110116]$ qsub populations_TdimFloragenex_DAPC.sh 
432464.m1.mason

#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=120gb,walltime=2:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N popDAPC_020116
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_110116/Floragenex_2016/refMapTdim_020116/outputTdim
populations -P ./ -M ./PopMapDAPC.txt -W ./Whitelist.txt -b 1 -S -t 36 -i 1 -p 3 -m 3  

#[lorantes@h1 scripts_110116]$ qsub populations_TdimFloragenex_Indiv.sh 
432468.m1.mason

#! /bin/bash
#PBS -k o
#PBS -l nodes=8:ppn=2,vmem=128gb,walltime=4:00:00
#PBS -M lorantes@uvm.edu
#PBS -m abe
#PBS -N popIndv_020116
#PBS -j oe

module load stacks
cd /N/dc2/scratch/scahan/sandbox_lucia_110116/Floragenex_2016/refMapTdim_020116/outputTdim
populations -P ./ -M ./PopMapDAPC.txt -W ./Whitelist.txt -b 1 -S -t 36 -i 1 -p 3 -m 3 


[lorantes@h1 outputTdim]$ cut -f21 batch_1.sumstats_summary.tsv 
# Variant positions
Pi
0.0857691
0.0989373
0.0931953
0.169598
# All positions (variant and fixed)
StdErr
5.11616e-05
5.59303e-05
5.22523e-05
6.40701e-05

[lorantes@h1 outputTdim]$ cut -f15 batch_1.sumstats_summary.tsv 
# Variant positions
# Variant positions
Exp Het
0.0679349
0.0779976
0.0835764
0.158555
# All positions (variant and fixed)
StdErr
4.6867e-05
5.38486e-05
3.5352e-05
3.44196e-05

[lorantes@h2 outputTdim]$ cut -f9 batch_1.sumstats_summary.tsv 
# Variant positions
Obs Het
0.045029
0.0564495
0.0413742
0.0617035
# All positions (variant and fixed)
StdErr
0.00110093
0.00116498
0.00234287
0.00514888